<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - GluPulse App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl border border-gray-100">
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-6">Selamat Datang</h1>
        <p class="text-center text-gray-500 mb-8">Masuk untuk melanjutkan ke akun Anda.</p>
        
        <form id="loginForm" class="space-y-4">
            <!-- Username Field -->
            <div>
                <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                <input type="text" id="username" name="username" placeholder="Masukkan Username Anda" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500 transition duration-150 shadow-sm">
            </div>

            <!-- Password Field -->
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="password" name="password" placeholder="Minimal 8 Karakter" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500 transition duration-150 shadow-sm">
                <!-- Forgot Password (Optional) -->
                <div class="mt-2 text-right">
                    <a href="#" class="text-sm text-sky-600 hover:text-sky-800 transition duration-150">Lupa Password?</a>
                </div>
            </div>

            <!-- Login Button -->
            <button type="submit" id="loginButton"
                    class="w-full bg-sky-600 text-white font-semibold py-2.5 rounded-lg hover:bg-sky-700 transition duration-300 shadow-lg shadow-sky-200/50">
                Login
            </button>
        </form>

        <div class="mt-6 flex items-center justify-between">
            <span class="w-full border-t border-gray-200"></span>
            <span class="text-xs text-gray-500 uppercase mx-3">Atau</span>
            <span class="w-full border-t border-gray-200"></span>
        </div>

        <!-- Login with Google -->
        <button id="googleLogin"
                class="w-full flex items-center justify-center space-x-2 border border-gray-300 bg-white text-gray-700 font-semibold py-2.5 rounded-lg hover:bg-gray-50 transition duration-300 mt-6 shadow-sm">
            <!-- Google Icon SVG (Placeholder) -->
            <svg class="w-5 h-5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.0003 4.75C14.0413 4.75 15.8283 5.43438 17.2023 6.75L20.4073 3.55C18.2393 1.51625 15.2893 0.25 12.0003 0.25C7.30032 0.25 3.23881 2.80252 1.2583 6.64375L4.40732 9.0725C5.35232 7.07018 7.57449 5.51475 12.0003 4.75Z" fill="#EA4335"/><path d="M23.7417 12.5C23.7417 11.5831 23.6599 10.597 23.4867 9.75H12.2517V14.25H18.7303C18.423 15.8294 17.595 17.078 16.5165 17.8425L19.7892 20.3113C21.7589 18.4113 22.8427 15.7667 23.2359 13.5656L23.7417 12.5Z" fill="#4285F4"/><path d="M12.2517 23.75C15.5407 23.75 18.4907 22.4837 20.4597 20.45L17.2027 17.25C15.8287 18.5656 14.0417 19.25 12.0007 19.25C7.57471 19.25 5.35252 17.6946 4.40752 15.6937L1.13477 18.1625C3.23805 21.9962 7.30068 24.5 12.0007 23.75Z" fill="#34A853"/><path d="M1.25841 12.5C1.25841 11.3934 1.48834 10.3708 1.89502 9.475L5.16773 11.9438C5.64571 12.1825 6.13689 12.4212 6.6669 12.5C6.88566 14.6562 7.7818 16.328 9.38072 17.6062L6.21679 20.3344C4.24778 18.3325 3.23841 15.7667 3.23841 12.5L1.25841 12.5Z" fill="#FBBC04"/></svg>
            <span>Masuk dengan Google</span>
        </button>

        <!-- Sign Up Link -->
        <p class="text-center text-sm text-gray-500 mt-8">
            Belum punya akun?
            <a href="register.html" class="font-semibold text-sky-600 hover:text-sky-800 transition duration-150">
                Daftar Sekarang
            </a>
        </p>

        <!-- Status/Message Box -->
        <div id="messageBox" class="mt-4 p-3 rounded-lg text-sm text-center hidden" role="alert"></div>
    </div>

    <script>
        const API_BASE_URL = window.location.origin;

        function showMessage(message, type) {
            const box = document.getElementById('messageBox');
            let classes = '';
            
            if (type === 'success') {
                classes = 'bg-green-100 text-green-800';
            } else if (type === 'error') {
                classes = 'bg-red-100 text-red-800';
            } else {
                classes = 'bg-blue-100 text-blue-800';
            }

            box.textContent = message;
            box.className = 'mt-4 p-3 rounded-lg text-sm text-center ' + classes;
            box.style.display = 'block';
        }

        // --- 1. Traditional Login Function ---
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');

            loginButton.disabled = true;
            loginButton.textContent = 'Memproses...';
            showMessage('Mencoba Login...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    // Success! Backend handles setting cookies (access-token, refresh-token)
                    showMessage('Login berhasil! Mengalihkan...', 'success');
                    
                    // Redirect to the web welcome pagewindow.location.href
                    setTimeout(() => {
                        window.location.href = '/welcome/web';
                    }, 500);

                } else {
                    const errorMessage = data.error || 'Terjadi kesalahan login yang tidak diketahui.';
                    showMessage(errorMessage, 'error');
                }
            } catch (error) {
                console.error('Network Error:', error);
                showMessage('Koneksi gagal. Periksa jaringan Anda.', 'error');
            } finally {
                loginButton.disabled = false;
                loginButton.textContent = 'Login';
            }
        });

        // --- 2. Google OAuth Function ---
        document.getElementById('googleLogin').addEventListener('click', function() {
            showMessage('Mengalihkan ke Google Sign-In...', 'info');
            // Redirects to the Go provider handler which starts the OAuth flow
            window.location.href = `${API_BASE_URL}/auth/google`;
        });

        // --- 3. Redirect to Sign Up ---
        document.querySelector('a[href="register.html"]').addEventListener('click', function(e) {
             e.preventDefault();
             window.location.href = '/register';
        });
    </script>
</body>
</html>
